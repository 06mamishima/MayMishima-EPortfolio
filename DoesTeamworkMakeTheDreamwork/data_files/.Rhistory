state,
city,
admit_rate = ADM_RATE,
SAT_avg = SAT_AVG,
grad_debt_median = GRAD_DEBT_MDN,
pct_mathstat = PCIP27,
cost_avg = COSTT4_A) |>
# Use right_join to only keep the colleges in our original sample
right_join(ma_sample |> select(institution, state, city)) |>
# Additional variables are character but should be numeric
mutate(across(admit_rate:cost_avg, ~ as.numeric(.)),
# Standardize or scale() numeric variables (subtract mean and divide by SD)
across(where(is.numeric),  ~ scale(.)[,1], .names = "{.col}_scaled")) |>
# Drop rows with missing values (kmeans breaks with missing values)
drop_na()
glimpse(ma_sample2)
# Clustering using standardized variables
set.seed(231)
ma2_km3_out <- ma_sample2 |>
select(ends_with("scaled")) |>
kmeans(centers = 3, nstart = 20)
# Clustering using unstandardized variables (for comparison)
set.seed(231)
ma2_km3_out_unscaled <- ma_sample2 |>
select(admit_rate:cost_avg) |>
kmeans(centers = 3, nstart = 20)
# Add cluster assignments to the data frame
ma_sample2 <- ma_sample2 |>
mutate(clusters3_scaled = factor(ma2_km3_out$cluster),
clusters3_unscaled = as.character(ma2_km3_out_unscaled$cluster))
# Clusters based on standardized vars
ma_sample2 |>
select(institution, clusters3_scaled) |>
arrange(clusters3_scaled)
# Clusters based on unstandardized vars
ma_sample2 |>
select(institution, clusters3_unscaled) |>
arrange(clusters3_unscaled)
#| fig-width: 6
#| fig-height: 6
# Scatterplot matrix of clusters based on scaled variables
GGally::ggpairs(data = ma_sample2,
aes(color = clusters3_scaled),
columns = c("admit_rate_scaled",
"SAT_avg_scaled",
"grad_debt_median_scaled",
"pct_mathstat_scaled",
"cost_avg_scaled"),
upper = list(continuous = "blank")) +
labs(title = "Clusters on Scaled Variables")
# Scatterplot matrix of clusters based on unscaled variables
GGally::ggpairs(data = ma_sample2,
aes(color = clusters3_unscaled),
columns = c("admit_rate",
"SAT_avg",
"grad_debt_median",
"pct_mathstat",
"cost_avg")) +
labs(title = "Clusters on Unscaled Variables")
#| include: false
# load packages
library(tidyverse)
library(kableExtra)
library(ggrepel)
# set code chunk defaults
knitr::opts_chunk$set(tidy = F, # display code as typed
size = "small", # slightly smaller code font
message = FALSE,
warning = FALSE,
comment = "\t")
# set black & white default plot theme
theme_set(theme_classic())
# improve digit and NA display
options(scipen = 1, knitr.kable.NA = '')
colleges <- read_csv("data/colleges_subset.csv") |>
# Missing scores reported as text "NULL"; make numeric
mutate(SAT_math25 = as.numeric(SATMT25),
SAT_verbal25 = as.numeric(SATVR25)) |>
rename(state = STABBR,
city = CITY,
institution = INSTNM)
dim(colleges)
head(colleges)
set.seed(231)
ma_sample <- colleges |>
# Only keep schools in MA
filter(state %in% c("MA")) |>
# Only keep schools with non-missing SAT scores
drop_na(SAT_math25, SAT_verbal25) |>
select(state, city, institution, SAT_math25, SAT_verbal25) |>
# Select a random sample of 15 schools
sample_n(15)
ggplot(data = ma_sample, aes(x = SAT_math25, y = SAT_verbal25)) +
geom_point() +
geom_text_repel(aes(label = institution), size = 3) +
labs(x = "Math SAT 25th Percentile",
y = "Verbal SAT 25th Percentile")
set.seed(230)
clustering_vars <- c("SAT_math25", "SAT_verbal25")
ma_km2 <- ma_sample |>
select(clustering_vars) |>
kmeans(centers = 2, nstart = 20)
# Vector of cluster assignments
ma_km2$cluster
# The centroids for the fit
ma_km2$centers
# Add cluster assignment to the data frame
ma_sample <- ma_sample |>
mutate(clusters2 = factor(ma_km2$cluster))
# Visualize the cluster assignments and centroids
ggplot(data = ma_sample, aes(x = SAT_math25, y = SAT_verbal25)) +
geom_point(aes(color = clusters2)) +
geom_text_repel(aes(label = institution, color = clusters2), size = 3) +
coord_fixed() +
geom_point(data = data.frame(ma_km2$centers),
aes(x = SAT_math25, y = SAT_verbal25),
pch = "x", size = 8) +
labs(x = "Math SAT (25th percentile)",
y = "Verbal SAT (25th percentile)",
color = "Cluster assignment")
set.seed(230)
clustering_vars1 <- c("SAT_math25", "SAT_verbal25")
ma_km5 <- ma_sample |>
select(clustering_vars) |>
kmeans(centers = 5, nstart = 20)
# Vector of cluster assignments
ma_km5$cluster
# The centroids for the fit
ma_km5$centers
# Add cluster assignment to the data frame
ma_sample <- ma_sample |>
mutate(clusters2 = factor(ma_km5$cluster))
# Visualize the cluster assignments and centroids
ggplot(data = ma_sample, aes(x = SAT_math25, y = SAT_verbal25)) +
geom_point(aes(color = clusters2)) +
geom_text_repel(aes(label = institution, color = clusters2), size = 3) +
coord_fixed() +
geom_point(data = data.frame(ma_km2$centers),
aes(x = SAT_math25, y = SAT_verbal25),
pch = "x", size = 8) +
labs(x = "Math SAT (25th percentile)",
y = "Verbal SAT (25th percentile)",
color = "Cluster assignment")
ma_km2$tot.withinss
ma_km5$tot.withinss #name depends on what you called the second solution
elbow_plot <- data.frame(clusters = 1:10,
within_ss = rep(NA, 10))
set.seed(75)
for (i in 1:10){
ma_kmi_out <- ma_sample |>
select(clustering_vars) |>
kmeans(centers = i, nstart = 20)
elbow_plot$within_ss[i] <- ma_kmi_out$tot.withinss
}
# Construct elbow plot
ggplot(elbow_plot, aes(x = clusters, y = within_ss)) +
geom_point() +
geom_line() +
scale_x_continuous(breaks = 1:10) +
labs(x = "Number of clusters (k)", y = expression("Total W"[k]))
# Select the additional variables of interest
ma_sample2 <- colleges |>
select(institution,
state,
city,
admit_rate = ADM_RATE,
SAT_avg = SAT_AVG,
grad_debt_median = GRAD_DEBT_MDN,
pct_mathstat = PCIP27,
cost_avg = COSTT4_A) |>
# Use right_join to only keep the colleges in our original sample
right_join(ma_sample |> select(institution, state, city)) |>
# Additional variables are character but should be numeric
mutate(across(admit_rate:cost_avg, ~ as.numeric(.)),
# Standardize or scale() numeric variables (subtract mean and divide by SD)
across(where(is.numeric),  ~ scale(.)[,1], .names = "{.col}_scaled")) |>
# Drop rows with missing values (kmeans breaks with missing values)
drop_na()
glimpse(ma_sample2)
# Clustering using standardized variables
set.seed(231)
ma2_km3_out <- ma_sample2 |>
select(ends_with("scaled")) |>
kmeans(centers = 3, nstart = 20)
# Clustering using unstandardized variables (for comparison)
set.seed(231)
ma2_km3_out_unscaled <- ma_sample2 |>
select(admit_rate:cost_avg) |>
kmeans(centers = 3, nstart = 20)
# Add cluster assignments to the data frame
ma_sample2 <- ma_sample2 |>
mutate(clusters3_scaled = factor(ma2_km3_out$cluster),
clusters3_unscaled = as.character(ma2_km3_out_unscaled$cluster))
# Clusters based on standardized vars
ma_sample2 |>
select(institution, clusters3_scaled) |>
arrange(clusters3_scaled)
# Clusters based on unstandardized vars
ma_sample2 |>
select(institution, clusters3_unscaled) |>
arrange(clusters3_unscaled)
#| fig-width: 6
#| fig-height: 6
# Scatterplot matrix of clusters based on scaled variables
GGally::ggpairs(data = ma_sample2,
aes(color = clusters3_scaled),
columns = c("admit_rate_scaled",
"SAT_avg_scaled",
"grad_debt_median_scaled",
"pct_mathstat_scaled",
"cost_avg_scaled"),
upper = list(continuous = "blank")) +
labs(title = "Clusters on Scaled Variables")
# Scatterplot matrix of clusters based on unscaled variables
GGally::ggpairs(data = ma_sample2,
aes(color = clusters3_unscaled),
columns = c("admit_rate",
"SAT_avg",
"grad_debt_median",
"pct_mathstat",
"cost_avg")) +
labs(title = "Clusters on Unscaled Variables")
# loads in the data
ccdata <- read_csv("data/cc-general.csv")
View(ccdata)
mplot(mod, which = 1)
library(mosaic)
library(Stat2Data)
library(DescTools)
options(digits = 6)
data(Alfalfa)
mod <- lm(Ht4 ~ Acid  + Row, data = Alfalfa)
anova(mod)
mplot(mod, which = 1)
View(mod)
mplot(mod, which = 2)
mplot(mod, which = 1)
gf_boxplot(Ht4 ~ Acid  + Row, data = Alfalfa)
gf_boxplot(Ht4 ~ Acid, color = ~ Row, data = Alfalfa)
gf_boxplot(Ht4 ~ Row, color = ~ Acid, data = Alfalfa)
mplot(mod, which = 1)
aovmod <- aov(mod <- lm(Ht4 ~ Acid  + Row, data = Alfalfa))
PostHocTest(aovmod, method = "lsd")
library(mosaic)
library(Stat2Data)
library(DescTools)
options(digits = 6)
data(Alfalfa)
mod <- lm(Ht4 ~ Acid  + Row, data = Alfalfa)
anova(mod)
mplot(mod, which = 1)
mplot(mod, which = 2)
aovmod <- aov(mod <- lm(Ht4 ~ Acid  + Row, data = Alfalfa))
PostHocTest(aovmod, method = "lsd")
library(mosaic)
library(Stat2Data)
library(DescTools)
options(digits = 6)
data(Alfalfa)
mod <- lm(Ht4 ~ Acid  + Row, data = Alfalfa)
anova(mod)
mplot(mod, which = 1)
mplot(mod, which = 2)
aovmod <- aov(mod <- lm(Ht4 ~ Acid  + Row, data = Alfalfa))
PostHocTest(aovmod, method = "lsd")
data(Popcorn)
glimpse(Popcorn)
head(Popcorn)
#Strongly recommend you LOOK at the data and make sure R is treating variables the way you expect. #This is also a hint that you need to do something here. You can force variables to be treated #numerically with as.numeric, and you can force variables to be treated categorically with #as.factor (or mutate them to factors with factor() like you saw in Hmk 6).
Popcorn <- mutate(Popcorn, Trial = factor(Trial))
View(Popcorn)
View(Popcorn)
Popcorn <- mutate(Popcorn, Trial = as.numeric(Unpopped))
Popcorn <- mutate(Popcorn, Trial = factor(Brand))
grand.mean <- mean(~ Unpopped, data = Popcorn)
grand.mean <- mean(~ Unpopped, data = Popcorn); grand.mean
brand.mean <- mean(Unpopped ~ Brand, data = Popcorn); brand.mean
trial.mean <- mean(Unpopped ~ Trial, data = Popcorn); trial.mean
trial.mean <- mean(Unpopped ~ Trial, data = Popcorn); trial.mean
brand.mean <- mean(Unpopped ~ Brand, data = Popcorn); brand.mean
trial.mean <- mean(Unpopped ~ Trial, data = Popcorn)); trial.mean)
trial.mean <- mean(Unpopped ~ Trial, data = Popcorn); trial.mean
brand.mean <- mean(Unpopped ~ Brand, data = Popcorn); brand.mean
trial.mean <- mean(Unpopped ~ Trial, data = Popcorn); trial.mean
brand.mean <- mean(Unpopped ~ Brand, data = Popcorn); brand.mean
Popcorn <- mutate(Popcorn, Brand = factor(Brand))
library(mosaic)
library(Stat2Data)
library(DescTools)
options(digits = 6)
data(Alfalfa)
mod <- lm(Ht4 ~ Acid  + Row, data = Alfalfa)
anova(mod)
mplot(mod, which = 1)
mplot(mod, which = 2)
aovmod <- aov(mod <- lm(Ht4 ~ Acid  + Row, data = Alfalfa))
PostHocTest(aovmod, method = "lsd")
data(Popcorn)
glimpse(Popcorn)
head(Popcorn)
Popcorn <- mutate(Popcorn, Trial = factor(Trial))
Popcorn <- mutate(Popcorn, Brand = factor(Brand))
Popcorn <- mutate(Popcorn, Trial = as.numeric(Unpopped))
library(mosaic)
library(Stat2Data)
library(DescTools)
options(digits = 6)
data(Alfalfa)
mod <- lm(Ht4 ~ Acid  + Row, data = Alfalfa)
anova(mod)
mplot(mod, which = 1)
mplot(mod, which = 2)
aovmod <- aov(mod <- lm(Ht4 ~ Acid  + Row, data = Alfalfa))
PostHocTest(aovmod, method = "lsd")
data(Popcorn)
glimpse(Popcorn)
head(Popcorn)
Popcorn <- mutate(Popcorn, Trial = factor(Trial))
Popcorn <- mutate(Popcorn, Brand = factor(Brand))
Popcorn <- mutate(Popcorn, Trial = as.numeric(Unpopped))
grand.mean <- mean(~ Unpopped, data = Popcorn); grand.mean
brand.mean <- mean(Unpopped ~ Brand, data = Popcorn); brand.mean
trial.mean <- mean(Unpopped ~ Trial, data = Popcorn); trial.mean
trial.mean <- mean(Unpopped ~ Trial, data = Popcorn); trial.mean
Popcorn <- mutate(Popcorn, Unpopped = as.numeric(Unpopped))
data(Popcorn)
glimpse(Popcorn)
head(Popcorn)
Popcorn <- mutate(Popcorn, Trial = factor(Trial))
Popcorn <- mutate(Popcorn, Brand = factor(Brand))
Popcorn <- mutate(Popcorn, Unpopped = as.numeric(Unpopped))
library(mosaic)
library(Stat2Data)
library(DescTools)
options(digits = 6)
data(Alfalfa)
mod <- lm(Ht4 ~ Acid  + Row, data = Alfalfa)
anova(mod)
mplot(mod, which = 1)
mplot(mod, which = 2)
aovmod <- aov(mod <- lm(Ht4 ~ Acid  + Row, data = Alfalfa))
PostHocTest(aovmod, method = "lsd")
data(Popcorn)
glimpse(Popcorn)
head(Popcorn)
Popcorn <- mutate(Popcorn, Trial = factor(Trial))
Popcorn <- mutate(Popcorn, Brand = factor(Brand))
Popcorn <- mutate(Popcorn, Unpopped = as.numeric(Unpopped))
grand.mean <- mean(~ Unpopped, data = Popcorn); grand.mean
brand.mean <- mean(Unpopped ~ Brand, data = Popcorn); brand.mean
trial.mean <- mean(Unpopped ~ Trial, data = Popcorn); trial.mean
group.mean - grand.mean
brand.mean - grand.mean
trial.mean - grand.mean
trial.mean <- mean(Unpopped ~ Trial, data = Popcorn); trial.mean
trial.mean - grand.mean
mplot(mod, which = 1)
mplot(mod, which = 2)
mod2 <- lm(Unpopped ~ Brand + Trial, data = Popcorn)
mplot(mod2, which = 1)
mplot(mod2, which = 2)
mplot(mod2, which = 1)
mplot(mod2, which = 2)
anova(mod2)
anova(mod2)
dbGetQuery(con, "SELECT SessionTotal, COUNT(SessionTotal) as n,
AVG(Sex = 'Female') as prop_fem,
AVG(AgeFirstMeasurement) as avg_age
FROM Subjects
GROUP BY SessionTotal")
#| include: false
# load packages
library(tidyverse)
library(kableExtra)
library(RMySQL)
# set code chunk defaults
knitr::opts_chunk$set(tidy = F, # display code as typed
size = "small", # slightly smaller code font
message = FALSE,
warning = FALSE,
comment = "\t")
# set black & white default plot theme
theme_set(theme_classic())
# improve digit and NA display
options(scipen = 1, knitr.kable.NA = '')
con <- dbConnect(MySQL(),
host = "scidb.smith.edu",
user = "waiuser",
password = "smith_waiDB",
dbname = "wai")
ggplot?
??ggplot
?ggplot
ggplot(table_name) + geom_point(mapping = aes(x = Frequency, y = Absorbance, color = Ear))
# dbConnect_scidb is accessible from the mdsr package
aircon <- dbConnect_scidb("airlines")
# dbConnect_scidb is accessible from the mdsr package
aircon <- dbConnect_scidb("airlines")
#| label: load-packages
#| include: false
library(kableExtra)
library(tidyverse)
library(mdsr)
library(RMySQL)
# add other packages needed here!
knitr::opts_chunk$set(
tidy=FALSE,     # display code as typed
size="small")   # slightly smaller font for code
# dbConnect_scidb is accessible from the mdsr package
aircon <- dbConnect_scidb("airlines")
# remember can use SHOW and EXPLAIN commands to explore what tables are available
# through this connection, and what variables/fields are in each table
dbGetQuery(aircon, "SHOW TABLES")
dbGetQuery(aircon, "EXPLAIN airports")
# can view first few obs of a table to see what the fields look like
dbGetQuery(aircon, "SELECT *
FROM airports
LIMIT 0,5")
#| label: load-packages
#| include: false
library(kableExtra)
library(tidyverse)
library(mdsr)
library(RMySQL)
# add other packages needed here!
knitr::opts_chunk$set(
tidy=FALSE,     # display code as typed
size="small")   # slightly smaller font for code
# dbConnect_scidb is accessible from the mdsr package
aircon <- dbConnect_scidb("airlines")
# remember can use SHOW and EXPLAIN commands to explore what tables are available
# through this connection, and what variables/fields are in each table
dbGetQuery(aircon, "SHOW TABLES")
dbGetQuery(aircon, "EXPLAIN airports")
# can view first few obs of a table to see what the fields look like
dbGetQuery(aircon, "SELECT *
FROM airports
LIMIT 0,5")
dbGetQuery(aircon, "EXPLAIN flights")
#| label: load-packages
#| include: false
library(kableExtra)
library(tidyverse)
library(mdsr)
library(RMySQL)
# add other packages needed here!
knitr::opts_chunk$set(
tidy=FALSE,     # display code as typed
size="small")   # slightly smaller font for code
# dbConnect_scidb is accessible from the mdsr package
aircon <- dbConnect_scidb("airlines")
# remember can use SHOW and EXPLAIN commands to explore what tables are available
# through this connection, and what variables/fields are in each table
dbGetQuery(aircon, "SHOW TABLES")
dbGetQuery(aircon, "EXPLAIN airports")
# can view first few obs of a table to see what the fields look like
dbGetQuery(aircon, "SELECT *
FROM airports
LIMIT 0,5")
dbGetQuery(aircon, "EXPLAIN flights")
#| label: load-packages
#| include: false
library(kableExtra)
library(tidyverse)
library(mdsr)
library(RMySQL)
# add other packages needed here!
knitr::opts_chunk$set(
tidy=FALSE,     # display code as typed
size="small")   # slightly smaller font for code
# dbConnect_scidb is accessible from the mdsr package
aircon <- dbConnect_scidb("airlines")
dbGetQuery(aircon, "EXPLAIN flights")
??transitivity
#importing pitching war 10/26
pwar25 <- read.csv("data_files/pwar2025 - Sheet1.csv")
setwd("~/Documents/GitHub/stat231maymishima/final_project/data_files")
#importing pitching war 10/26
pwar25 <- read.csv("pwar2025 - Sheet1.csv")
overalldata21 <- read.csv("WAR2021 - Sheet1.csv")
View(pwar25)
#remove multi-teams(2TM, 3TM, etc) by filtering for multi-teams
pitchers25 <- pitchers25 |>
filter(str_detect(Team, "^(2TM|3TM|4TM|5TM)$"))
#importing pitching data 10/26
pitchers25 <- read.csv("pwar2025 - Sheet1.csv")
#remove multi-teams(2TM, 3TM, etc) by filtering for multi-teams
pitchers25 <- pitchers25 |>
filter(str_detect(Team, "^(2TM|3TM|4TM|5TM)$"))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(purrr)
library(dplyr)
library(stringr)
library(readr)
library(readr)
library(mosaic)
library(GGally)
library(gridExtra)
#remove multi-teams(2TM, 3TM, etc) by filtering for multi-teams
pitchers25 <- pitchers25 |>
filter(str_detect(Team, "^(2TM|3TM|4TM|5TM)$"))
pitchers19 <- read.csv("pitching2019.csv")
setwd("~/Documents/GitHub/stat231maymishima/final_project/data_files")
pitchers19 <- read.csv("pitching201")
pitchers19 <- read.csv("pitching2019")
pitchers19 <- read.csv("pitching2019 - Sheet1.csv")
pitchers18 <- read.csv("pitching2018 - Sheet1.csv")
pitchers17 <- read.csv("pitching2017 - Sheet1.csv")
pitchers16 <- read.csv("pitching2016 - Sheet1.csv")
pitchers14 <- read.csv("pitching2014 - Sheet1.csv")
pitchers11 <- read.csv("pitching2011 - Sheet1.csv")
